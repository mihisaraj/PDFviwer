{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/hts/Documents/Development/PDF%20viewr/PDFviwer/components/FlipBook.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useRef, forwardRef, useEffect } from 'react';\nimport HTMLFlipBook from 'react-pageflip';\nimport { Document, Page, pdfjs } from 'react-pdf';\nimport type { PDFDocumentProxy } from 'pdfjs-dist';\nimport { Loader2 } from 'lucide-react';\n\n// Configure PDF worker from local copy to avoid CORS issues on mobile/web\nif (typeof window !== 'undefined') {\n  // Build an absolute URL for the worker to avoid basePath and CDN edge cases\n  const workerUrl = new URL('/pdf.worker.min.mjs', window.location.origin).toString();\n  pdfjs.GlobalWorkerOptions.workerSrc = workerUrl;\n}\n\ninterface PageProps {\n  pageNumber: number;\n  width: number;\n  height: number;\n  density?: 'soft' | 'hard';\n}\n\ninterface FlipBookProps {\n  file: File | string;\n  onPageChange?: (page: number) => void;\n  onLoadSuccess?: (data: PDFDocumentProxy) => void;\n  usePortrait?: boolean;\n  zoom?: number;\n}\n\n// ForwardRef is needed for HTMLFlipBook children\nconst PDFPage = forwardRef<HTMLDivElement, PageProps>(({ pageNumber, width, height, density = 'soft' }, ref) => {\n  return (\n    <div ref={ref} className=\"bg-white shadow-md overflow-hidden\" data-density={density}>\n      <div className=\"relative w-full h-full flex items-center justify-center\">\n        <Page\n          pageNumber={pageNumber}\n          width={width}\n          height={height}\n          className=\"w-full h-full\"\n          renderTextLayer={false}\n          renderAnnotationLayer={false}\n        />\n        {/* Page shadow/gradient overlay for realism */}\n        <div className=\"absolute inset-0 pointer-events-none bg-gradient-to-r from-black/5 via-transparent to-transparent\" />\n      </div>\n    </div>\n  );\n});\n\nPDFPage.displayName = 'PDFPage';\n\nconst FlipBook = forwardRef<any, FlipBookProps>(\n  ({ file, onPageChange, onLoadSuccess, usePortrait = false, zoom = 1 }, ref) => {\n  const [numPages, setNumPages] = useState<number>(0);\n  const [loadError, setLoadError] = useState<string | null>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [containerSize, setContainerSize] = useState({ width: 0, height: 0 });\n\n  useEffect(() => {\n    const element = containerRef.current;\n    if (!element) return;\n\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        const { width, height } = entry.contentRect;\n        setContainerSize({ width, height });\n      }\n    });\n\n    resizeObserver.observe(element);\n    return () => resizeObserver.disconnect();\n  }, []);\n\n  const { width: containerWidth, height: containerHeight } = containerSize;\n\n  const onDocumentLoadSuccess = (data: PDFDocumentProxy) => {\n    setLoadError(null);\n    setNumPages(data.numPages);\n    onLoadSuccess?.(data);\n  };\n\n  // Calculate optimal book dimensions based on container\n  // Enforce A4 aspect ratio (1 / sqrt(2) â‰ˆ 0.707) for realistic PDF look\n  const ASPECT_RATIO = 0.707; // Width / Height\n\n  // Base sizing from height, then apply zoom\n  const heightFactor = usePortrait ? 0.9 : 0.94;\n  const adjustedZoom = Math.max(0.6, Math.min(zoom, 1.6));\n\n  const baseHeight = containerHeight ? containerHeight * heightFactor : 600;\n  const baseWidth = baseHeight * ASPECT_RATIO;\n\n  let bookHeight = baseHeight * adjustedZoom;\n  let bookWidth = baseWidth * adjustedZoom;\n\n  // Keep within container width to avoid cropping in double-page mode\n  const currentTotalWidth = usePortrait ? bookWidth : bookWidth * 2;\n  const maxTotalWidth = containerWidth\n    ? usePortrait\n      ? containerWidth * 0.95\n      : containerWidth * 1.4\n    : undefined;\n\n  if (maxTotalWidth && currentTotalWidth > maxTotalWidth) {\n    const scaleDown = maxTotalWidth / currentTotalWidth;\n    bookWidth *= scaleDown;\n    bookHeight *= scaleDown;\n  }\n\n  // Round values to avoid sub-pixel rendering issues\n  bookHeight = Math.floor(bookHeight);\n  bookWidth = Math.floor(bookWidth);\n\n  return (\n    <div \n      ref={containerRef} \n      className=\"w-full h-full flex items-center justify-center bg-transparent overflow-auto relative p-2 sm:p-4\"\n    >\n      {!containerWidth ? (\n        <div className=\"text-white flex items-center gap-2\">\n          <Loader2 className=\"animate-spin\" /> Loading Viewer...\n        </div>\n      ) : loadError ? (\n        <div className=\"text-center text-sm text-red-200 max-w-sm\">\n          <p className=\"font-semibold mb-1\">Could not load PDF.</p>\n          <p className=\"opacity-80 break-words\">{loadError}</p>\n        </div>\n      ) : (\n        <Document\n          file={file}\n          onLoadSuccess={onDocumentLoadSuccess}\n          onLoadError={(err) => {\n            console.error('Failed to load PDF', err);\n            const msg = typeof err === 'string' ? err : err?.message || 'Please refresh or try a different network.';\n            setLoadError(msg);\n          }}\n          loading={\n            <div className=\"text-white flex items-center gap-2\">\n              <Loader2 className=\"animate-spin\" /> Loading PDF...\n            </div>\n          }\n          className=\"flex justify-center items-center\"\n        >\n          {numPages > 0 && (\n            // @ts-ignore - react-pageflip types can be tricky\n            <HTMLFlipBook\n              key={`${usePortrait ? 'portrait' : 'landscape'}-${Math.round(adjustedZoom * 100)}`} // Force re-render on view/zoom change\n              width={bookWidth}\n              height={bookHeight}\n              size=\"fixed\"\n              minWidth={200} // Lower min width for mobile\n              maxWidth={1000}\n              minHeight={300} // Lower min height for mobile\n              maxHeight={1533}\n              maxShadowOpacity={0.5}\n              showCover={true}\n              mobileScrollSupport={true} // This should handle touch scroll\n              className=\"shadow-2xl\"\n              ref={ref}\n              onFlip={(e: any) => onPageChange?.(e.data + 1)}\n              flippingTime={1000}\n              usePortrait={usePortrait}\n              startZIndex={0}\n              autoSize={true}\n              drawShadow={true}\n              showPageCorners={true}\n              disableFlipByClick={false}\n            >\n              {Array.from(new Array(numPages), (el, index) => (\n                <PDFPage\n                  key={`page_${index + 1}`}\n                  pageNumber={index + 1}\n                  width={bookWidth}\n                  height={bookHeight}\n                />\n              ))}\n            </HTMLFlipBook>\n          )}\n        </Document>\n      )}\n    </div>\n  );\n});\n\nFlipBook.displayName = 'FlipBook';\n\nexport default FlipBook;\n"],"names":[],"mappings":"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"}}]
}